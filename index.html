<!DOCTYPE html>
<html ng:app="FoursquareApp">
	<head>
		<meta charset="utf-8" />
		
		
		<title>Foursquare</title>
		
		
		<meta name="viewport" content="width=device-width">
		
		<script type="text/javascript" src="/components/angular/angular.js"></script>
		<script type="text/javascript" src="/components/angular-resource/angular-resource.js"></script>
		<script type="text/javascript" src="/components/angularjs-foursquare/angularjs-foursquare.js"></script>
		<script type="text/javascript" src="/components/angularjs-webapp/angularjs-webapp.js"></script>
		
		<script type="text/javascript" src="/index.js"></script>
		
		<link rel="stylesheet" type="text/css" href="/index.css"></link>
	</head>
	<body ng:controller="FoursquareApp" role="application">
		
		
		<section role="region" ng:controller="FoursquareSettings" id="settings" class="skin-organic">
			<header>
				<button screen="$backOrHome"><span class="icon icon-close">Close</span></button>
				<h1>Settings</h1>
			</header>
			
			<div role="main">
				<button ng:click="fsq.logout()" screen="$home" ng:show="fsq.logged">log out</button>
			</div>
		</section>
		
		<section role="region" ng:controller="FoursquareHome" id="home" class="background">
			<header>
				<button screen="#settings"><span class="icon icon-menu">Settings</span></button>
				<button screen="$home"><span class="icon icon-menu">Settings</span></button>
				<menu type="toolbar">
					<button screen="#search"><span class="icon icon-search">Search</span></button>
				</menu>
				<h1>Foursquare</h1>
			</header>
			<progress ng:show="loading" value="0" max="100" class="pack-activity"></progress>
			
			<div role="main">
				<p>
					<fsq:login ng:show="!fsq.logged" fsq:display="touch" fsq:color="blue"></fsq:login>
				</p>
				
				<p ng:show="loading">Loading recent checkins…</p>
				<p ng:show="!loading && fsq.logged && !checkins.length">No recent checkin</p>
				<div data-type="list">
					<ul ng:show="checkins.length">
						<li ng:repeat="checkin in checkins">
							<a screen="#checkin" screen:model="checkin">
								<aside class="pack-end">
									<img fsq:photo="checkin.user.photo" fsq:photo-size="cap60" />
								</aside>
								<p>
									<strong>{{ checkin.user.firstName }}</strong> at {{ checkin.venue.name }}
								</p>
								<p>
									<date>{{ checkin.createdAt*1000 | date }}</date>
								</p>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</section>
		
		<section role="region" ng:controller="FoursquareSearch" id="search" data-viewport="right">
			<header>
				<button screen="$home"><span class="icon icon-back">Back</span></button>
				<h1>Foursquare</h1>
			</header>
			
			<div role="main">
				<form>
					<p>
						<input type="search" ng:model="place" ng:model-delay placeholder="Where are you?"/>
					</p>
					<p>
						<input type="search" ng:model="query" ng:model-delay placeholder="What are you looking for?"/>
					</p>
				</form>
				
				<progress value="0" max="100" class="pack-activity" ng:style="{true:{}, false: {visibility: 'hidden'}}[loading]"></progress>
				
				<div ng:show="query && place" data-type="list">
					<p ng-show="!loading && !geocode">Cannot find {{ place }}</p>
					<p ng-show="!loading && geocode && !venues.length">no results for {{ query }} near {{ geocode.displayName }}</p>
					
					<ul ng-show="venues.length">
						<li ng:repeat="venue in venues">
							<a screen="#venue" screen:model="venue"><p>{{ venue.name }}</p></a>
						</li>
					<ul>
				</div>
			</div>
		</section>
		
		<section role="region" ng:controller="FoursquareCheckin" id="checkin" ng:model="checkin" data-viewport="right">
			<header>
				<button screen="$backOrHome"><span class="icon icon-back">Back</span></button>
				<h1>{{ checkin.user.firstName || 'Someone' }} at {{ checkin.venue.name }}</h1>
			</header>
			<progress ng:show="loading || checkingin" class="pack-activity" value="0" max="100"></progress>
			
			<div role="main">
				<ul ng:show="checkin.venue.categories.length" class="categories">
					<li ng:repeat="category in checkin.venue.categories">
						<img fsq:photo="category.icon" fsq:photo-size="bg_32" alt="{{ category.name }}" title="{{ category.name }}"/>
					</li>
				</ul>
				<h2><a screen="#venue" screen:model="checkin.venue">{{ checkin.venue.name }}</a></h2>
				
				<button ng:show="checkin.id && !checkin.like" ng:click="checkin.like = true ; checkin.likes = fsq.api.checkins.like({checkin_id: checkin.id, set: 1})">Like</button>
				<button ng:show="checkin.id && checkin.like"  ng:click="checkin.like = false; checkin.likes = fsq.api.checkins.like({checkin_id: checkin.id, set: 0})">Unlike</button>
				<p ng:show="checkin.likes.count">❤ {{ checkin.likes.summary }} like this</p>
				
				<p role="status" ng:show="loading">
					<span ng:show="">Loading comments & photos…</span>
				</p>
				<div data-type="list" ng:show="checkin.shout || checkin.comments.count">
					<ul>
						<li ng:show="checkin.shout">
							<aside class="pack-end">
								<img fsq:photo="checkin.user.photo" fsq:photo-size="cap60" />
							</aside>
							<p>
								{{ checkin.shout }}
							</p>
							<p>
								<em>{{ checkin.user.firstName }}</em> - {{ checkin.createdAt*1000 | date }}
								<progress ng:show="checkingin" class="pack-activity" value="0" max="100"></progress>
							</p>
						</li>
						<li ng:repeat="comment in checkin.comments.items">
							<aside class="pack-end">
								<img fsq:photo="comment.user.photo" fsq:photo-size="cap60" />
							</aside>
							<p>
								{{ comment.text }}
							</p>
							<p>
								<em>{{ comment.user.firstName }}</em> - {{ comment.createdAt*1000 | date }}
								<progress ng:show="!comment.id" class="pack-activity" value="0" max="100"></progress>
							</p>
						</li>
					</ul>
				</div>
				<form ng:show="checkin.id" ng:submit="postComment()">
					<p>
						<input type="text" ng:model="new_comment" required ng:disabled="posting"/>
						<button type="submit" ng:disabled="posting">Post comment</button>
					</p>
				</form>
				<form ng:show="!checkin.id" ng:submit="checkIn()">
					<p>
						<input type="text" ng:model="new_shout" ng:disabled="checkingin" autofocus placeholder="What are you doing?"/>
						<button type="submit" ng:disabled="checkingin" class="recommend">Check in!</button>
					</p>
				</form>
				
				<div data-type="list" ng:show="checkin.photos.count">
					<ul>
						<li ng:repeat="photo in checkin.photos.items">
							<aside>
								<img fsq:photo="photo" fsq:photo-size="cap100" />
							</aside>
							<p>
								{{ photo.user.firstName }}
							</p>
							<p>
								<date>{{ photo.createdAt*1000 | date }}</date>
							</p>
						</li>
					</ul>
				</div>
			</div>
		</section>
		
		<section role="region" ng:controller="FoursquareVenue" id="venue" ng:model="venue" data-viewport="right">
			<header>
				<button screen="$backOrHome"><span class="icon icon-back">Back</span></button>
				<menu type="toolbar">
					<button ng:disabled="!me" screen="#checkin" screen:model="{venue: venue, user: me}"><span class="icon icon-add">Checkin</span></button>
				</menu>
				<h1>{{ venue.name }}</h1>
			</header>
			<progress ng:show="loading" class="pack-activity" value="0" max="100"></progress>
			
			<div role="main">
				<p ng:show="loading">loading photos…</p>
				<p ng:show="!loading && !venue.photos.count">no photo</p>
				
				<div data-type="list" ng:show="!loading && venue.photos.count" ng:repeat="group in venue.photos.groups">
					<header>{{ group.name }}</header>
					<ul>
						<li ng:repeat="photo in group.items">
							<aside>
								<img ng:src="{{photo.prefix}}cap100{{photo.suffix}}"/>
							</aside>
							<p>
								{{ photo.user.firstName }}
							</p>
							<p>
								<date>{{ photo.createdAt*1000 | date }}</date>
							</p>
						</li>
					</ul>
				</div>
			</div>
		</section>
	</body>
</html>